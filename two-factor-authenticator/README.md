# Two-Factor Authenticator

Source: <https://blog.gojekengineering.com/a-diy-two-factor-authenticator-in-golang-32e5641f6ec5>

## 1. Introduction

- [Multi-factor authentication](https://en.wikipedia.org/wiki/Multi-factor_authentication).
- Two-factor authentication (2FA) is a method of confirming users' claimed identities by using a combination of two different factors:
  - Something they know - usual password.
  - Something they have/Something they are - a verification code retrieved from an app on a mobile device or computer.

## 2. How to generate an OTP (Google Authenticator)

- Google Authenticator is used for two-step verification based on [Time-based One Time Password (TOTP)](https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm) and [HMAC-based One Time Password (HOTP)](https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm).

  - TOTP is an algorithm that computes a one-time password from a shared secret key and the current time.
  - HTOP is an algorithm which uses hmac algorithm to generate a one-time password.

- Pseudo code:

```
// Secret is the 16 digit token - generated by authenticator itself.
function GoogleAuthenticatorCode(string secret)
    // Decode secret in base12 (Allowing characters form [A-Z] and [0â€“9])
    key := base32decode(secret)
    // 30 is used as we need a new code every 30 seconds.
    message := floor(current Unix time / 30)
    // Hashing
    hash := HMAC-SHA1(key, message)
    offset := last nibble of hash
    truncatedHash := hash[offset..offset+3]  //4 bytes starting at the offset
    Set the first bit of truncatedHash to zero  //remove the most significant bit
    code := truncatedHash mod 1000000
    pad code with 0 from the left until length of code is 6
    return code
```
