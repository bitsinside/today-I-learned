# Integration patterns in Microservice world

Source: <https://dzone.com/articles/integration-patterns-in-microservices-world>

Table of content:

- [Integration patterns in Microservice world](#integration-patterns-in-microservice-world)
  - [1. Overview](#1-overview)
    - [1.1. Understanding "integration" - Applications, Integration, and Microservice](#11-understanding-integration---applications-integration-and-microservice)
    - [1.2. Synchronous vs Asynchronous Integration](#12-synchronous-vs-asynchronous-integration)
  - [2. Integration Styles and Patterns](#2-integration-styles-and-patterns)
    - [2.1. General Integration Principles](#21-general-integration-principles)
    - [2.2. Related Enterprise Architecture Principles](#22-related-enterprise-architecture-principles)
    - [2.3. Integration Patterns - API](#23-integration-patterns---api)
      - [2.3.1. Patterns](#231-patterns)
      - [2.3.2. Constraints](#232-constraints)
    - [2.4. Integration Patterns – Messaging](#24-integration-patterns--messaging)
      - [2.4.1. Patterns](#241-patterns)
      - [2.4.2. Constraints](#242-constraints)
    - [2.5. Integration Patterns – File](#25-integration-patterns--file)
      - [2.5.1. Patterns](#251-patterns)
      - [2.5.2. Constraints](#252-constraints)

## 1. Overview

### 1.1. Understanding "integration" - Applications, Integration, and Microservice

- Integration system vs applications:
  - Integration facilitates the transmission of information between systems and may be realized through the use of technologies.
  - Integration system should not hold business logic or manage business state.
  - Technical components: API Gateway, ESBs, File Transfer Systems and Messaging Systems.
- Business logic the programmatic encoding of real-world business rules that govern the access and lifecycle of business domain data.
  - Sematic transformation: requires an interpretation of business entities and their attributes following business rules.
  - Process, Orchestration, or Workflow: requires the execution of the steps of a business process, with business context, rules and management of state.
  - Data Enrichment: requires business context, state and/or rules.
- Business logic should only be implemented within an application, not within an integration layer.

### 1.2. Synchronous vs Asynchronous Integration

- Synchronous communication:
  - Consumer submits a request to a service and waits for the service to respond before the consumer can continue executing its process.
  - Example: HTTP, used with API style of integration:
    - HTTP by nature is synchronous.
    - Ideally: milliseconds to a few seconds (timeout 30-60 seconds)
- Asynchronous communication:
  - The consumer submits a message to a service but not need to wait for the service to respond. A consequence of the message in the form of a new message may be returned to the consumer at some point in the future or not at all.
  - Example: AMQP, MQTT, WebSockets,...

## 2. Integration Styles and Patterns

> **Styles**: high level, abstract, approaches to integration that represent a number of specific patterns.
> **Patterns**: Technology agnostic, generic designs that address common business problems/scenarios.

- The following integration styles:
  - API
  - Messaging
  - File Transfer

![](https://dz2cdn1.dzone.com/storage/temp/14890953-1624564471281.png)

| API                                                                                                                                                                                                                                                                                                                                                                                                  | Messaging                                                                                                                                                                                                                                                                                                                                | File Transfer                                                                                                                                                                                                                                                                                                                                                                                |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Application submits data, requests data or issues command to an internal or external application or service that requires immediate processing of submitted data or command and subsequent near-immediate response is expected.                                                                                                                                                                      | Application submits data or issues command to an internal application or service that does not require a near-immediate response.                                                                                                                                                                                                        | Transfer large data set to one or more applications as a bulk data set as part of a batch process.                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                                      | Application submits data or issues command to an internal application or service that is likely to have an on-going planned or unplanned outages and does not require a near-immediate response.                                                                                                                                         | Existing application only supports file transfer-based integration.                                                                                                                                                                                                                                                                                                                          |
|                                                                                                                                                                                                                                                                                                                                                                                                      | Application submits data or issues command to multiple internal applications or services but does not require near-immediate response.                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                                                                                                                                                                                                                                                                                                                                                      | Application submits a high volume of data or commands to one or more internal applications or services and does not require a near-immediate response.                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                              |
| Example                                                                                                                                                                                                                                                                                                                                                                                              | Example                                                                                                                                                                                                                                                                                                                                  | Example                                                                                                                                                                                                                                                                                                                                                                                      |
| Customer requests an account via web application in digital channel. The customer has submitted their details and is awaiting a response. The response time requirement is < 3 seconds. A number of components are integrated through a series of API-based calls. This example illustrates a synchronous interaction with an end user and supporting systems that follow the API style integration. | An update to a customer’s profile is made via a web application in the digital channel. A number of systems must be notified of the changes in order for them to change their own records. This example illustrates an asynchronous update of multiple systems that does not require a response to be returned to the initiating system. | A large number of charging requests are generated on a nightly basis and must be issued to the financial system once a night for processing. A file transfer style of integration may be used to transfer the payment requests within one or more files that are transferred as part of a batch process to the financial system. This example illustrates a file transfer style integration. |

### 2.1. General Integration Principles

| Principle                                                                                                                                                                                                                                                    | Condition                                                                             | Guidelines                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Reasoning                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Business logic should not be implemented within the integration technology layer.<br>The integration layer includes the following technical components: API gateways, ESBs, File Transfer Systems or Messaging Systems. (Think dumb pipes, smart end points) | All                                                                                   | Integration should facilitate the exchange of information between applications.<br>Integration components should not include any business logic or state.<br>Integration adapters used as a façade to API providers should not include any business logic or state.<br>Syntactic transformation for the purpose of implementing an integration adapter is not considered business logic.<br>Data enrichment is considered business logic and must not be implemented within the integration layer. This may be implemented by a package application or a microservice.<br>Orchestration is considered business logic and must not be implemented within an integration layer. This may be implemented by a package application or microservice. | Microservices are components of an application, not an integration in of itself.<br>Integration technologies are primarily designed for data transfer and have significantly less capability in solving the complex and broad set of business problems when compared with an application technology that is programmable using a general programming language.<br>Placing business logic in an integration technology mixed with the responsibility of data transfer causes a high risk of the logic being “orphaned’ outside of the applications and/or microservices that have clearly been marked as encapsulating/owning the logic for a particular business function/capability. This leads to both overhead and confusion when maintaining and extending this capability. |
| Packaged application suites comprising individually deployed applications should not have an intermediary service inserted between inter-application integration.                                                                                            | Packaged suite inter-application integration deemed internal or private by the vendor | Packaged suite applications may integration directly via point-to-point interface as inherent within the product                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | The integration between packaged application suite components have typically been built and tested by vendors to operate in a tightly integrated fashion. Inserting intermediary (e.g. API Gateways, microservices) components between pre-built components may affect performance, reliability and support.<br>Interface contracts between suite applications are volatile and may change with version updates to the products causing additional effort to update the intermediate components.                                                                                                                                                                                                                                                                                |
| Business capabilities may be exposed by packaged applications or custom microservices.                                                                                                                                                                       | All                                                                                   | Business capabilities such as Risk Engines and Product Pricing may be realised through a packaged application, a custom microservice or a combination of both.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Leverage the value provided by investments in strategic package solutions.<br>Minimise the impact on costs and supportability of modifying strategic package solutions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

### 2.2. Related Enterprise Architecture Principles

| Principles                                                                                                                                                                                                                                                                    | Condition | Guidelines                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Reasoning                                                                                                                                                                                                                                                                                                     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Capability that exists within a strategic packaged application should not be hollowed out into an independent microservice if the capability does not need to be independently managed or developed and at the expense of significant cost and supportability of the package. | All       | Packaged applications should not be modified to extract and disable business capability that is central to the package operation if the capability does not need to be independently managed or developed.<br>Package applications should not be modified to extract and disable business capability if by doing so significant cost and supportability is incurred.<br>Capabilities within a packaged application may be enhanced or extended within a reasonable cost (balance cost/return).<br>Capabilities within a packaged application may be realised by complementing the inherent features within the packaged application or microservice or other systems. | Leverage the value provided by the investments in strategic packaged solutions.<br>Minimise the impact on cost and supportability of modifying strategic packaged solutions.<br>It takes significant engineering effort to implement the equivalent of packaged solutions that have had years of development. |

### 2.3. Integration Patterns - API

#### 2.3.1. Patterns

| Pattern                      | Description                                                                                                                                                                                                                      | When to use                                                                                                                                                                                                                                              | Considerations                                                                                                                                                                                                                                                                                                                |
| ---------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Request/response             | A consumer submits a request to an application that processes the request and returns the result over the same client connection                                                                                                 | When the response from the request is required within a short time frame and the consumer can't continue without the result.<br>(Short < 60 seconds)                                                                                                     | This pattern results in temporal coupling between the consumer and the API provider. If the API provider is not availble, the consumer is unable to submit requests.                                                                                                                                                          |
| Request/Acknowledge/Poll     | A consumer submits a request to an application that is processed in the background. The application returns a response acknowledging receipt of the request                                                                      | When the response from the request is not required within a short time frame.<br>The consumer may periodically submit a request for the status or result of the processing of the request.<br>(Short < 30 seconds)                                       | The acknowledgement response to the request should include a link for the consumer to submit requests for status or the full results of the processing of the request.<br>The pattern is suitable for devie-side integration with [System of Engagement (SoE)](https://www.dynamicyield.com/glossary/systems-of-engagement/). |
| Request/Acknowledge/Callback | A consumer submits a request to an application that is processed in the background. The application returns a response acknowledging receipt of the request.<br>The application calls the consumer when the action is completed. | When the response from the request is not required within a short time frame but the consumer needs to be notified when the result is ready.<br>The consumer requires to be called by the provider when the result is available.<br>(Short < 30 seconds) | The initial request should include a link for the provider to perform a callback to the consumer when it has completed processing the request.                                                                                                                                                                                |
| Consumer Adapter             | A component implemented to map between the consumer's own information model and protocol to that of the APIs.                                                                                                                    | A consumer can't consume an API directly and requires transformation to map from its own domain model to that of the API it is consuming                                                                                                                 | Whilst the consumer adapter could be implemented as part of the provider (microservice or packaged application). It is strongly encouraged to be implemented by the consumer                                                                                                                                                  |

#### 2.3.2. Constraints

| Constraint&nbsp;                                                                                                                                         | Condition                                                                                                    | Rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Reasoning                                                                                                                                                                                                                   |
| -------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APIs must confirm to the REST architectural style                                                                                                        | Developing a new API as part of bespoke application or microservice                                          | APIs must be stateless.APIs must conform to a uniform interface based on HTTP operations.Resources must be identified in the request.Support Hypermedia as the engine of application state (HATEOS).Resources may be cacheable.Refer to API Standards document for further constraints.                                                                                                                                                                                                    | Ensure a consistent implementation of APIs improving supportability and implementation efficiency.                                                                                                                          |
| Payload schema must be participant independent.                                                                                                          | Developing a new API as part of a bespoke application or microservice.                                       | The payload schema must be based on a system independent information model.                                                                                                                                                                                                                                                                                                                                                                                                                | Provides decoupling between applications.                                                                                                                                                                                   |
| Payload schema must be defined.                                                                                                                          | Participant is an external vendor’s System of Record.                                                        | Payload exchanged with an external vendor’s System of Record must be based on a client defined system independent information model.                                                                                                                                                                                                                                                                                                                                                       | Provides decoupling between application and external provider.                                                                                                                                                              |
| API payloads must be in JSON format                                                                                                                      | Developing a new API as part of a bespoke application or microservice.                                       | Request and response payloads must be in JSON format.Refer to API Standards document for further constraints.                                                                                                                                                                                                                                                                                                                                                                              | Provides a consistent and easy to consume and manage format.                                                                                                                                                                |
| Syntactic and/or semantic transformation of downstream provider data is the responsibility of the API intermediary (application/microservice)            | Developing a new application or microservice that consumes one or more downstream providers with fixed APIs. | API consumers must adopt the independently defined information model and schema.The API intermediary will perform syntactic and/or semantic transformation from the independently defined information model and schema to a downstream provider system’s information model and schema.Downstream providers that require custom built interfaces may expose system independent information model to avoid API intermediary transformation as provider system owners know their system best. | Provides decoupling between consumer applications and provider applications.                                                                                                                                                |
| Internal consumer of external system must call external provider APIs via the DMZ Web Proxy.                                                             | All                                                                                                          | Internal applications consuming APIs of external systems must call the external provider APIs via the DMZ Web Proxy.                                                                                                                                                                                                                                                                                                                                                                       | Provides a secure, demarcation between internal and external provider systems.                                                                                                                                              |
| External consumers of internal systems must call the internal provider APIs via the external API Gateway.                                                | All                                                                                                          | External consumers must call internal APIs via the external API gateway.                                                                                                                                                                                                                                                                                                                                                                                                                   | Provides a secure, demarcation between internal and external providers systems where security controls and policies may be enforced.                                                                                        |
| Existing internal systems must expose their API services using either HTTP based (with XML or JSON payload) OR SOAP based (with XML payload) end points. | All                                                                                                          | Service contract specifications must be documents.Service contracts must have defined schemas.SOAP services must have published WSDL files.                                                                                                                                                                                                                                                                                                                                                | Limit the number of API end point types reducing the need for too many connector frameworks.                                                                                                                                |
| Business logic should not be implemented within the integration layer.                                                                                   | All                                                                                                          | Integration should facilitate the exchange of information between applications.Integration should not include any business logic or persistence.                                                                                                                                                                                                                                                                                                                                           | Microservices are components of an application.                                                                                                                                                                             |
| Application APIs must be registered with a service registration and its documentation published to a developer portal.                                   | All                                                                                                          | Exposed application APIs (packaged or microservice) must be registered.Point-to-point internal package or microservice to microservice within a bounded context does not need registration with a service registry.                                                                                                                                                                                                                                                                        | Internal package to package point-to-point registries that will not be consumed by other components will not require discovery services.Microservice-to-microservice point to point will be managed through a service mesh. |
| Internal consumers of internal microservices must call the APIs via the internal API Gateway.                                                            | All                                                                                                          | Internal Application or microservice APIs may be exposed via an internal API gateway.                                                                                                                                                                                                                                                                                                                                                                                                      | Consistent policy, security and management of APIs within the organisation.                                                                                                                                                 |

### 2.4. Integration Patterns – Messaging

#### 2.4.1. Patterns

| Pattern&nbsp;          | Description                                                                                                                                     | When to use                                                                                                                                                                                                                                                                                                                                                          | Considerations                                                                                                                                                                                                                                                                                    |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Publish-Subscribe      | An application submits a message of which one or more applications may receive the message.                                                     | One or more applications need to receive the message.The publisher does not need to know who will consume the message.The publisher does not block waiting for a response.                                                                                                                                                                                           | The order of which the subscriber receives and processes the messages will not be guaranteed.                                                                                                                                                                                                     |
| Point-to-Point         | An application submits a message targeted for only one application.                                                                             | A command is given to a system with sole responsibility for processing the command (e.g. payment processing).High volume load on target system may impact system’s capacity to process messages.Availability of target system may fluctuate and require a buffer to allow publishing system to continue sending messages even if the target system is not available. | Sufficient queue depth of message channel should be used to protect target system from high volume spikes.                                                                                                                                                                                        |
| Event Message          | An application submits a notification of the occurrence of an event of which one or more applications may be interested in receiving the event. | One or more applications need to know when a specific business event has occurred in a time sensitive manner.The emitter of the event does not need to know who will consume the event.The event content typically contains a small payload to describe the state change.                                                                                            | If the event message does not include the details of the state and only indicates that the state has changed the receiver will need to perform a query against the source system to retrieve the state details. To avoid this extra call, include state information in the event message payload. |
| Channel Adaptor        | Proxy client bridging between non-messaging to messaging systems.                                                                               | Support for applications that do not support interfacing directly to messaging system.May implement syntactic transformation.                                                                                                                                                                                                                                        | HTTP based Channel Adaptors must not be used to implement a synchronous use case.                                                                                                                                                                                                                 |
| Dead Letter Channel    | A channel for messages that cannot be delivered.                                                                                                | The messaging system is unable to deliver the message due to invalid configuration, message expiry or invalid header.                                                                                                                                                                                                                                                | Once misconfiguration or availability of consuming system is restored the message can be consumed by replaying it.                                                                                                                                                                                |
| Invalid Letter Channel | A channel for messages that a receiver cannot process.                                                                                          | When an application retrieves a message from the channel but is unable to parse the message.                                                                                                                                                                                                                                                                         | Where a Channel Adaptor is utilised the Channel, Adaptor is responsible for putting an invalid message onto the Invalid Letter Channel.Message schema/content should be corrected by publisher before re-publishing message.                                                                      |

#### 2.4.2. Constraints

| Constraint&nbsp;                                                                             | Condition                                                                                           | Rules                                                                                                                                                                                   | Reasoning                                                                                                                                                          |
| -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Message schema must be participant independent.                                              | Multiple Consumers or Multiple Providers                                                            | The schema must be based on a system independent information model.                                                                                                                     | Provides decoupling between applications.                                                                                                                          |
| Message schema may be consumer or provider based.                                            | Consumer and Provider interfaces are custom developed and unlikely to introduce other participants. | The schema may be based on a system independent information model if the effort to prepare the schema is cost effective.The schema may be based on the consumer or the provider system. | Avoids effort of creating participant independent model if there is unlikely to be another participant to benefit from the common information model-based mapping. |
| Message schema must be defined.                                                              | Participant is an external vendor’s System of Record.                                               | Messages exchanged with an external vendor’s System of Record must be based on a defined system independent information model.                                                          | Provides decoupling between client system and external provider.                                                                                                   |
| Payload must be in JSON format.                                                              | All                                                                                                 | The message payload must be in JSON format with a defined JSON schema.                                                                                                                  | Provides a consistent and easy to consume and manage format.                                                                                                       |
| Semantic transformation is the responsibility of the applications.                           | All                                                                                                 | Publishers or subscribers must adopt the independently defined information model and schema.Syntactic transformation may be implemented by the integration layer.                       | Provides decoupling between applications.Avoids embedding syntactic transformation mapping logic for each application within messaging system.                     |
| Channel Adaptors for external systems must call external provider APIs via the DMZ Web Proxy | All                                                                                                 | Internal channel adaptors consuming APIs of external systems must call the external provider APIs via the DMZ Web Proxy.                                                                | Provides secure decoupling between client and external providers.                                                                                                  |

### 2.5. Integration Patterns – File

#### 2.5.1. Patterns

| Pattern&nbsp;      | Description                                                                                       | When to use                                                                                                                     | Considerations |
| ------------------ | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | -------------- |
| Point-to-point     | An application creates one or more files to be consumed by a single target system.                | Only one target is required to consume the file and it is highly unlikely any other target will require the file in the future. |                |
| One-to-Many        | An application creates one or more files to be consumed by multiple target systems.               | Multiple applications need to receive the file.The source system does not need to know who will consume the message.            |                |
| File Transport     | Files are transferred between source and target system via an intermediary file transport system. | The source and target system do not have access to a shared file system.                                                        |                |
| Shared File System | Files are transferred between source and target system via a shared file system.                  | The source and target system have access to a shared file system.                                                               |                |

#### 2.5.2. Constraints

| Constraint&nbsp;                                                                                              | Condition | Rules                                                                                                                                                                          | Reasoning                                                                 |
| ------------------------------------------------------------------------------------------------------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------- |
| File format must be defined by the source system.                                                             | All       | The file format must be defined by the source system.Target systems are responsible for any steps necessary for the parsing of the files including transformation and mapping. | Avoid introducing an intermediary to perform file transformation.         |
| File transferred from internal systems to external systems must be transported by SFTP via the DMZ Web Proxy. | All       | Files to be transported to an external system must be done so via the SFTP protocol.                                                                                           | Provides secure transport across organisation boundaries.                 |
| Files transferred from an external system to an internal system must be transported by SFTP.                  | All       | Files to be transported from an external system to an internal system must be done so via the SFTP protocol.                                                                   | Provides secure transport across organisation boundaries.                 |
| File formats must be either CSV, XML or JSON format.                                                          | All       | The format of files transferred between source and target systems must be either CSV, XML or JSON.                                                                             | Provides a consistent, compressible and easy to consume and mange format. |
