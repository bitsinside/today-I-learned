# Causal Consistency

Source: <https://www.mongodb.com/docs/manual/core/causal-consistency-read-write-concerns/>

## 1. Causal Consistencty Guarantees

<table cellspacing="0" cellpadding="0" class="leafygreen-ui-bwkhid"><thead><tr class="" data-testid="leafygreen-ui-header-row"><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-172epv7"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Guarantees</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-1pj2m7y"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Description</span></div></th></tr></thead><tbody><tr role="row" class="leafygreen-ui-e3rzul" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Read your writes</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Read operations reflect the results of write
operations that precede them.</span></div></td></tr><tr role="row" class="leafygreen-ui-e3rzul" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Monotonic reads</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><p class="leafygreen-ui-39zjpx">Read operations do not return results that correspond to an
earlier state of the data than a preceding read operation.</p><p class="leafygreen-ui-39zjpx">For example, if in a session:</p><ul class="leafygreen-ui-rioki0"><li class="leafygreen-ui-ldnju"><p class="leafygreen-ui-39zjpx">write <sub>1</sub> precedes write <sub>2</sub>,</p></li><li class="leafygreen-ui-ldnju"><p class="leafygreen-ui-39zjpx">read <sub>1</sub> precedes read <sub>2</sub>, and</p></li><li class="leafygreen-ui-ldnju"><p class="leafygreen-ui-39zjpx">read <sub>1</sub> returns results that reflect write <sub>2</sub></p></li></ul><p class="leafygreen-ui-39zjpx">then read <sub>2</sub> cannot return results of write <sub>1</sub>.</p></span></div></td></tr><tr role="row" class="leafygreen-ui-e3rzul" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Monotonic writes</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><p class="leafygreen-ui-39zjpx">Write operations that must precede other writes are executed
before those other writes.</p><p class="leafygreen-ui-39zjpx">For example, if write <sub>1</sub> must precede write <sub>2</sub> in
a session, the state of the data at the time of write <sub>2</sub>
must reflect the state of the data post write <sub>1</sub>. Other
writes can interleave between write <sub>1</sub> and write write
<sub>2</sub>, but write <sub>2</sub> cannot occur before write
<sub>1</sub>.</p></span></div></td></tr><tr role="row" class="leafygreen-ui-e3rzul" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Writes follow reads</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">Write operations that must occur after read operations are
executed after those read operations. That is, the state of the
data at the time of the write must incorporate the state of the
data of the preceding read operations.</span></div></td></tr></tbody></table>

## 2. Causal Consistency and Read and Write Concerns

- With MongoDB's causally consistent client sessions, different combinations of read and write concerns provide different causal consistency guarantees.

<table cellspacing="0" cellpadding="0" class="leafygreen-ui-bwkhid"><thead><tr class="" data-testid="leafygreen-ui-header-row"><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Read Concern</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Write Concern</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Read own writes</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Monotonic reads</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Monotonic writes</span></div></th><th role="columnheader" scope="col" aria-sort="none" class="leafygreen-ui-xvkcb9"><div class="leafygreen-ui-1mwn02k"><span class="leafygreen-ui-nem3xz">Writes follow reads</span></div></th></tr></thead><tbody><tr role="row" class="leafygreen-ui-1qt859n" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/read-concern-majority/#mongodb-readconcern-readconcern.-majority-"><code class="leafygreen-ui-1nwfx0p">"majority"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/write-concern/#mongodb-writeconcern-writeconcern.-majority-"><code class="leafygreen-ui-1nwfx0p">"majority"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td></tr><tr role="row" class="leafygreen-ui-1qt859n" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/read-concern-majority/#mongodb-readconcern-readconcern.-majority-"><code class="leafygreen-ui-1nwfx0p">"majority"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/write-concern/#mongodb-writeconcern-writeconcern.-number-"><code class="leafygreen-ui-1nwfx0p">{ w: 1 }</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td></tr><tr role="row" class="leafygreen-ui-1qt859n" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/read-concern-local/#mongodb-readconcern-readconcern.-local-"><code class="leafygreen-ui-1nwfx0p">"local"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/write-concern/#mongodb-writeconcern-writeconcern.-number-"><code class="leafygreen-ui-1nwfx0p">{ w: 1 }</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td></tr><tr role="row" class="leafygreen-ui-1qt859n" aria-disabled="false"><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/read-concern-local/#mongodb-readconcern-readconcern.-local-"><code class="leafygreen-ui-1nwfx0p">"local"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"><a class="leafygreen-ui-1tujn97" href="/docs/manual/reference/write-concern/#mongodb-writeconcern-writeconcern.-majority-"><code class="leafygreen-ui-1nwfx0p">"majority"</code></a></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844">✅</span></div></td><td class="leafygreen-ui-373k5a"><div class="leafygreen-ui-1sg2lsz" data-leafygreen-ui="td-inner-div"><span class="leafygreen-ui-1auv844"></span></div></td></tr></tbody></table>

- For example, consider a situation where a network partition divides a 5 member replica set:
  - Writes with `majority` write concern can complete on P<sub>new</sub> but can't complete on P<sub>old</sub>.
  - Writes with `{ w: 1 }` write concern can complete on either P<sub>old</sub> or P<sub>new</sub>. However, the writes to P<sub>old</sub> (as well as the writes replicated to S<sub>1</sub>) roll back once these members regain communication with the rest of the replica set.
  - After a successful write with `majority` write concern on P<sub>new</sub>, causally consistent reads with `majority` read concern can observe the write on P<sub>new</sub>, S<sub>2</sub>, and S<sub>3</sub>. The reads can also observe the write on P<sub>old</sub> and S<sub>1</sub> once they can communicate with the rest of the replica set and sync from the other members of the replica set. Any writes made to P<sub>old</sub> and/or replicated to S<sub>1</sub> during the partition are rolled back.

![](https://www.mongodb.com/docs/manual/images/network-partition-two-primaries.svg)

- To illustrate the read and write concern requirements, the following scenarios have a client issue a sequence of operations with various combination of read and write concerns to the replica set.
- **WIP**: Check the rest in the source.
